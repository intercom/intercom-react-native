#!/bin/sh

#
# Functions
#
function log() {
  echo "\n"
  echo "======================================="
  echo "$1"
  echo "======================================="
}

log "ðŸŽï¸  Running React native setup script ðŸŽï¸"

log "ðŸ“± Installing xcode tools ðŸ“±"

if [ ! -f /Library/Developer/CommandLineTools/usr/lib/libxcrun.dylib ]; then
  echo "âš ï¸ Xcode CommandLineTools not found installing. Please install and rerun this script âš ï¸"
  xcode-select --install
  exit 1
fi
echo "Xcode CommandLineTools installed ðŸ‘"

if ! [ -x "$(command -v xcode-select)" ]; then
  echo "âš ï¸ You need Xcode to setup this project. Please install and rerun this script âš ï¸"
  exit 1
fi

log "ðŸ‘€ Looking for Homebrew ðŸ‘€"
if ! [ -x "$(command -v brew)" ]; then
  echo "ðŸº Installing Homebrew ðŸº"
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  echo 'export PATH=/opt/homebrew/bin:$PATH' >> ~/.bash_profile
  echo 'export PATH=/opt/homebrew/bin:$PATH' >> ~/.zshrc
else
  echo "Homebrew already installed ðŸ‘"
fi

log "ðŸ‘€ Looking for rbenv ðŸ‘€"
if ! [ -x "$(command -v rbenv)" ]; then
  echo "ðŸº Installing rbenv with brew ðŸº"
  brew install rbenv ruby-build
  echo 'eval "$(rbenv init -)"' >> ~/.bash_profile
  echo 'eval "$(rbenv init -)"' >> ~/.zshrc
  eval "$(rbenv init -)"
else
  echo "rbenv already installed ðŸ‘"
fi

rbenv install --skip-existing
echo "Ruby setup complete ðŸ‘"

log "ðŸ‘€ Looking for nvm ðŸ‘€"
if ! [ -x "$(command -v nvm)" ]; then
  echo "ðŸº Installing nvm with brew ðŸº"
  brew install nvm
fi

# Source nvm
export NVM_DIR="$HOME/.nvm"
[ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && \. "/opt/homebrew/opt/nvm/nvm.sh"

nvm install
echo "Node.js setup complete ðŸ‘"

log "ðŸ‘€ Looking for yarn ðŸ‘€"
if ! [ -x "$(command -v yarn)" ]; then
  echo "ðŸº Installing yarn ðŸº"
  brew install yarn
else
  echo "yarn already installed ðŸ‘"
fi

log "ðŸ“Ÿ installing dependencies ðŸ“Ÿ"
yarn

log "ðŸ“Ÿ installing dependencies for our example app ðŸ“Ÿ"
cd example/ios
pod install
cd -

echo "You're all set up ðŸ‘"
echo "ðŸ“± Run example app on iOS using -> yarn example ios"
echo "ðŸ“± Run example app on android using -> yarn example android"
